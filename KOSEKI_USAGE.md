# 戸籍PDF解析機能 使用方法

この機能を使用すると、戸籍謄本のPDFファイルをアップロードして、Gemini 2.5 Pro AIを使って自動的に家系図データを抽出できます。

## 使用手順

### 1. PDF アップロード
- 左側のサイドバーにある「戸籍PDFをアップロード」エリアをクリック
- ダイアログが開きます

### 2. ファイル選択
- PDFファイルを選択（application/pdf形式のみサポート）
- 保存するJSONファイルの名前を設定（デフォルトはPDFファイル名）

### 3. 解析実行
- 「解析開始」ボタンをクリック
- Gemini AIがPDFを解析し、家系図データを抽出します
- 進行状況がプログレスバーで表示されます

### 4. 結果確認
- 解析完了後、抽出された人物数と家族関係数が表示されます
- JSONファイルは自動的に保存されます
- 必要に応じて「JSONダウンロード」ボタンでファイルをダウンロードできます

## データ構造

抽出されるJSONデータは以下の構造になります：

```json
{
  "people": [
    {
      "id": "person_id",
      "generation": 1,
      "sex": "male|female|null",
      "name": {
        "surname": "姓",
        "given_name": "名"
      },
      "birth": {
        "original_date": "戸籍上の表記",
        "date": "YYYY-MM-DD",
        "place": "出生地"
      },
      "death": {
        "original_date": "戸籍上の表記",
        "date": "YYYY-MM-DD",
        "place": "死亡地"
      }
    }
  ],
  "families": [
    {
      "id": "family_id",
      "parents": ["parent1_id", "parent2_id"],
      "children": ["child1_id", "child2_id"],
      "marriage_date": {
        "original_date": "戸籍上の表記",
        "date": "YYYY-MM-DD"
      },
      "divorce_date": {
        "original_date": "戸籍上の表記",
        "date": "YYYY-MM-DD"
      },
      "relation_type": "blood|adoption"
    }
  ]
}
```

## 注意事項

1. **API制限**: Gemini APIの利用制限に注意してください
2. **ファイルサイズ**: 大きなPDFファイルは処理に時間がかかる場合があります
3. **精度**: AIによる解析のため、結果を確認して必要に応じて手動で修正してください
4. **プライバシー**: 戸籍データは機密情報です。安全な環境でご利用ください

## トラブルシューティング

### エラーが発生した場合
- インターネット接続を確認
- PDFファイルが正しい形式か確認
- ファイルサイズが適切か確認
- しばらく時間をおいて再試行

### 結果が不正確な場合
- PDF画質が低い場合は、より高画質のPDFを使用
- 手書き部分が多い場合は、手動での修正が必要
- 古い戸籍で文字が読みにくい場合は、拡大コピーを使用

## ファイル保存場所

- **公開ディレクトリ**: `/public/` フォルダに `filename_timestamp.json` として保存
- **ローカルストレージ**: ブラウザのローカルストレージにもバックアップ保存
- **ダウンロード**: 手動でJSONファイルをダウンロード可能 